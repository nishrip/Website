<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Animation with Responsive Nav</title>
<link rel="stylesheet" href="global.css">
</head>
<body>

<!-- Navigation -->
<nav>
  <div class="logo">My3DSite</div>
  <div class="nav-links" id="navLinks">
    <a href="#portfolio">PORTFOLIO</a>
    <a href="#services">PREISE</a>
    <a href="#clients">CLIENTS</a>
    <a href="#contact">KONTAKT</a>
  </div>
  <div class="hamburger" id="hamburger">
    <div></div>
    <div></div>
    <div></div>
  </div>
</nav>

<!-- Background animation -->
<canvas id="sequence"></canvas>

<!-- Scroll spacer to allow scrolling through frames -->
<div style="height:12200px;"></div>

<script>
const canvas = document.getElementById("sequence");
const ctx = canvas.getContext("2d");

const frameCount = 120; // 0000.jpg → 0120.jpg
const images = [];
let currentFrame = 0;

const getFramePath = i => `frames3/${(i + 0).toString().padStart(4,'0')}.jpg`;

const initialWidth = window.innerWidth;
const initialHeight = window.innerHeight;

canvas.width = initialWidth;
canvas.height = initialHeight;

function drawImageCover(img) {
  const scale = Math.max(
    initialWidth / img.width,
    initialHeight / img.height
  );
  const x = (initialWidth/2) - (img.width/2)*scale;
  const y = (initialHeight/2) - (img.height/2)*scale;
  ctx.clearRect(0,0,initialWidth,initialHeight);
  ctx.drawImage(img, x, y, img.width*scale, img.height*scale);
}

function loadFrame(i) {
  if (i < 0 || i >= frameCount) return;
  if (!images[i]) {
    const img = new Image();
    img.src = getFramePath(i);
    img.onload = () => {
      if (i === currentFrame) drawImageCover(img);
    };
    images[i] = img;
  }
  return images[i];
}

// preload a range of frames around current
function preloadNearbyFrames(center, range = 20) {
  for (let offset = -range; offset <= range; offset++) {
    loadFrame(center + offset);
  }
}

// preload first frame
loadFrame(0);
preloadNearbyFrames(0, 20);

window.addEventListener("scroll", () => {
  const scrollTop = window.scrollY;
  const maxScroll = document.body.scrollHeight - window.innerHeight;
  const scrollFraction = scrollTop / maxScroll;
  const frameIndex = Math.min(
    frameCount - 1,
    Math.floor(scrollFraction * frameCount)
  );

  if (frameIndex !== currentFrame) {
    currentFrame = frameIndex;
    const img = loadFrame(currentFrame);
    if (img?.complete) {
      drawImageCover(img);
    }
    // preload around current frame
    preloadNearbyFrames(currentFrame, 20); // change 20 → 30 if you want more
  }
});

window.addEventListener("resize", () => {
  if (images[currentFrame]?.complete) {
    drawImageCover(images[currentFrame]);
  }
});

// Hamburger menu toggle
const hamburger = document.getElementById("hamburger");
const navLinks = document.getElementById("navLinks");

hamburger.addEventListener("click", () => {
  navLinks.classList.toggle("show");
});
</script>
</body>

</html>




