<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Landing Page with Sections</title>
<link rel="stylesheet" href="global.css">
<style>

/* Section bar */
section {
  position: relative;
  margin: 50% auto;
  padding: 6rem 1rem;
  width: 90%;
  max-width: 900px;
  background: rgba(0, 0, 0, 0.84);
  border-radius: 20px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.4);
  z-index: 1;
}

/* Mask container */
section .mask {
  position: relative;
  overflow: hidden;
  max-height: calc(100vh - 100px);
  margin: 0 auto;
}

/* Content */
section .content {
  max-width: 900px;
  margin: 0 auto;
  padding: 2rem 3rem;
  color: #ffffff;
  text-align: center;
}

/* Responsive */
@media (max-width: 480px) {
  section {
    padding: 4rem 1rem;
    width: 95%;
    border-radius: 16px;
  }
  section .content {
    padding: 1.5rem 1rem;
  }
}
</style>
</head>
<body>

<!-- Navigation -->
<nav>
  <div class="logo"><a href="index.html">PREISE</a></div>
  <div class="nav-links" id="navLinks">
    <a href="portfolio.html">PORTFOLIO</a>
    <a href="#">PREISE</a>
    <a href="#">CLIENTS</a>
    <a href="#">KONTAKT</a>
  </div>
  <div class="hamburger" id="hamburger">
    <div></div><div></div><div></div>
  </div>
</nav>

<!-- Background animation -->
<canvas id="sequence"></canvas>

<!-- Sections -->
<section id="section1">
  <div class="mask">
    <div class="content">
      <h2>About Me</h2>
      <p>Lorem ipsum dolor sit amet, consetetur sadipscing elitr...</p>
      <p>More text... keep scrolling to test slit cutoff effect at top/bottom.</p>
    </div>
  </div>
</section>

<section id="section2">
  <div class="mask">
    <div class="content">
      <h2>Skills & Services</h2>
      <p>Placeholder for describing what you offer and your expertise.</p>
      <p>Extra text to demonstrate scrollable content inside the slit mask.</p>
      <p>Even more filler text to see the cutoff working nicely.</p>
    </div>
  </div>
</section>

<section id="section3">
  <div class="mask">
    <div class="content">
      <h2>Contact</h2>
      <p>Placeholder for your contact info or call to action.</p>
      <p>You can add forms or links here. They’ll also get clipped at the slit boundaries.</p>
    </div>
  </div>
</section>

<script>
// Canvas animation setup
const canvas = document.getElementById("sequence");
const ctx = canvas.getContext("2d");
const frameCount = 120;
const images = [];
let currentFrame = 0;
let targetFrame = 0;

// Frame path generator
const getFramePath = i => `frames3/${i.toString().padStart(4,'0')}.jpg`;

// --- Device-based maximum screen size --- //
const deviceScreenWidth = window.screen.width;
const deviceScreenHeight = window.screen.height;

// Canvas wird auf die maximale Displaygröße fixiert (+ Puffer)
let canvasWidth = deviceScreenWidth;
let canvasHeight = deviceScreenHeight + 100; // +100px extra buffer unten
canvas.width = canvasWidth;
canvas.height = canvasHeight;

function drawImageCover(img) {
  const scale = Math.max(canvasWidth / img.width, canvasHeight / img.height);
  const x = (canvasWidth / 2) - (img.width / 2) * scale;
  const y = (canvasHeight / 2) - (img.height / 2) * scale;
  ctx.clearRect(0, 0, canvasWidth, canvasHeight);
  ctx.drawImage(img, x, y, img.width * scale, img.height * scale);
}

function loadFrame(i) {
  if (i < 0 || i >= frameCount) return;
  if (!images[i]) {
    const img = new Image();
    img.src = getFramePath(i);
    img.onload = () => { if (i === currentFrame) drawImageCover(img); };
    images[i] = img;
  }
  return images[i];
}

function preloadNearbyFrames(center, range = 20) {
  for (let offset = -range; offset <= range; offset++) {
    loadFrame(center + offset);
  }
}

loadFrame(0);
preloadNearbyFrames(0, 20);

window.addEventListener("scroll", () => {
  const scrollTop = window.scrollY;
  const scrollHeight = document.body.scrollHeight - window.innerHeight;
  const scrollFraction = scrollTop / scrollHeight;
  targetFrame = Math.min(frameCount - 1, Math.floor(scrollFraction * frameCount));
});

function animateFrames() {
  if (currentFrame !== targetFrame) {
    const dir = targetFrame > currentFrame ? 1 : -1;
    currentFrame += dir;
    const img = loadFrame(currentFrame);
    if (img?.complete) drawImageCover(img);
    preloadNearbyFrames(currentFrame, 20);
  }
  requestAnimationFrame(animateFrames);
}
animateFrames();

// --- Handle echte Resizes (Rotation, Desktop Resize) --- //
let lastOrientation = window.orientation || 0;

function updateCanvasSize() {
  const newOrientation = window.orientation || 0;

  // Nur reagieren bei echter Drehung oder Desktop-Resize
  if (window.innerWidth !== canvasWidth || window.innerHeight !== canvasHeight || newOrientation !== lastOrientation) {
    lastOrientation = newOrientation;
    canvasWidth = window.innerWidth;
    canvasHeight = window.innerHeight + 100;
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
    if (images[currentFrame]?.complete) drawImageCover(images[currentFrame]);
  }
}

window.addEventListener("orientationchange", updateCanvasSize);
window.addEventListener("resize", updateCanvasSize);

// Hamburger menu
const hamburger = document.getElementById("hamburger");
const navLinks = document.getElementById("navLinks");
hamburger.addEventListener("click", () => navLinks.classList.toggle("show"));
</script>

</body>
</html>
